"""
生成 HR 資料處理工具的測試 Excel 檔案
每個模組至少 10 筆模擬案例
"""

import pandas as pd
from openpyxl import Workbook
from openpyxl.styles import Font, PatternFill, Alignment, Border, Side
from datetime import datetime, timedelta
import random
import os

# 設定輸出目錄
OUTPUT_DIR = '/home/claude/hr_data_tool/tests/test_data'
os.makedirs(OUTPUT_DIR, exist_ok=True)

# 共用資料
DEPARTMENTS = ['研發一部', '研發二部', '品保部', '製造部', '人資部', '財務部', '業務部', '採購部']
NAMES = ['王小明', '李美玲', '張大偉', '陳怡君', '林志豪', '黃淑芬', '劉建宏', '吳雅琪', 
         '蔡明哲', '許雅婷', '楊宗翰', '鄭佳蓉', '周俊傑', '謝宜靜', '趙文彬']
COURSES = ['新人訓', '資安訓練', 'ISO 14001', '職安衛生', '專案管理', '溝通技巧', 'Python 入門', 'Excel 進階']

def create_style():
    """建立共用樣式"""
    header_fill = PatternFill(start_color='4472C4', end_color='4472C4', fill_type='solid')
    header_font = Font(bold=True, color='FFFFFF')
    thin_border = Border(
        left=Side(style='thin'),
        right=Side(style='thin'),
        top=Side(style='thin'),
        bottom=Side(style='thin')
    )
    return header_fill, header_font, thin_border

def apply_header_style(ws, header_fill, header_font, thin_border):
    """套用表頭樣式"""
    for cell in ws[1]:
        cell.fill = header_fill
        cell.font = header_font
        cell.border = thin_border
        cell.alignment = Alignment(horizontal='center')

# ============================================================
# 模組 1: 報表合併器 - 測試資料
# 建立 3 份欄位名稱不同但內容相似的報表
# ============================================================

def create_m1_test_data():
    print("建立模組 1 測試資料: 報表合併器...")
    
    # 報表 A: 用「員工編號」「員工姓名」
    data_a = {
        '員工編號': ['A001', 'A002', 'A003', 'A004', 'A005', 'A006', 'A007', 'A008', 'A009', 'A010'],
        '員工姓名': NAMES[:10],
        '所屬部門': random.choices(DEPARTMENTS, k=10),
        '完訓時數': [random.randint(8, 40) for _ in range(10)],
        '應完訓時數': [32] * 10,
        '備註': [''] * 10
    }
    df_a = pd.DataFrame(data_a)
    df_a.to_excel(f'{OUTPUT_DIR}/test_m1_report_A.xlsx', index=False)
    
    # 報表 B: 用「工號」「姓名」「部門代碼」
    data_b = {
        '工號': ['A011', 'A012', 'A013', 'A014', 'A015', 'A003', 'A005', 'A016', 'A017', 'A018'],
        '姓名': ['周俊傑', '謝宜靜', '趙文彬', '孫麗華', '何志強', '張大偉', '林志豪', '馬小芳', '高明德', '施雅玲'],
        '部門代碼': ['RD1', 'RD2', 'QA', 'MFG', 'HR', 'RD1', 'RD2', 'FIN', 'SALES', 'PUR'],
        '已完訓時數': [28, 35, 20, 16, 32, 24, 30, 18, 22, 26],
        '目標時數': [32] * 10,
        '完訓率': ['87.5%', '100%', '62.5%', '50%', '100%', '75%', '93.8%', '56.3%', '68.8%', '81.3%']
    }
    df_b = pd.DataFrame(data_b)
    df_b.to_excel(f'{OUTPUT_DIR}/test_m1_report_B.xlsx', index=False)
    
    # 報表 C: 用「EmpID」「EmpName」(英文欄位)
    data_c = {
        'EmpID': ['A019', 'A020', 'A001', 'A004', 'A021', 'A022', 'A023', 'A024', 'A025', 'A026'],
        'EmpName': ['林曉華', '陳建志', '王小明', '陳怡君', '葉俊宏', '蕭美惠', '潘志明', '羅雅芳', '魏大同', '江秀英'],
        'Department': ['R&D', 'QA', 'R&D', 'MFG', 'HR', 'FIN', 'SALES', 'PUR', 'R&D', 'QA'],
        'TrainingHours': [30, 25, 32, 28, 18, 22, 35, 20, 27, 31],
        'RequiredHours': [32] * 10
    }
    df_c = pd.DataFrame(data_c)
    df_c.to_excel(f'{OUTPUT_DIR}/test_m1_report_C.xlsx', index=False)
    
    print(f"  ✓ 建立 3 份報表: test_m1_report_A/B/C.xlsx")


# ============================================================
# 模組 2: 資料清洗器 - 測試資料
# 包含各種需要清洗的髒資料
# ============================================================

def create_m2_test_data():
    print("建立模組 2 測試資料: 資料清洗器...")
    
    # 包含各種髒資料的範例
    data = {
        '工號': ['A001', 'A002 ', ' A003', 'A004', 'A005', 'A006', 'A007', 'A008', 'A001', 'A009', 'A010', 'A011'],  # 有空白、有重複
        '姓名': ['王小明', '李美玲 ', ' 張大偉', '陳怡君', '林志豪', '黃淑芬', '劉建宏', '吳雅琪', '王小明', '蔡明哲', '許雅婷', None],  # 有空白、重複、空值
        '部門': ['研發一部', '研發二部', '品保部', '', '人資部', '財務部', '業務部', '研發一部', '研發一部', None, '製造部', '採購部'],  # 有空值
        '到職日': ['2024/01/15', '2024-02-20', '20240310', '2024.04.05', '2024/05/12', '2024-06-18', '2024/07/22', '2024/08/30', '2024/01/15', '2024-09-05', '2024/10/10', '2024/11/15'],  # 日期格式不一致
        '電話': ['0912-345-678', '0923456789', '09-34567890', '0945 678 901', '', '0967890123', '0978-901-234', '0989012345', '0912-345-678', '0990-123-456', None, '0911222333'],  # 電話格式不一致
        '薪資': ['50000', '52,000', '55000元', 'NT$58000', '60000', '62000', '65,000', '68000', '50000', '70000', '72000', ''],  # 數字格式不一致
        '備註': ['正常', '  需追蹤  ', '', '特殊狀況：需注意', None, '已確認', '待處理', '正常', '正常', '\n換行測試\n', '	Tab測試	', '正常']  # 有特殊字元
    }
    
    df = pd.DataFrame(data)
    df.to_excel(f'{OUTPUT_DIR}/test_m2_dirty_data.xlsx', index=False)
    
    print(f"  ✓ 建立髒資料範例: test_m2_dirty_data.xlsx (12 筆)")


# ============================================================
# 模組 3: 流程範本系統 - 測試資料
# 模擬主管拆分後的報表 (需合併)
# ============================================================

def create_m3_test_data():
    print("建立模組 3 測試資料: 流程範本系統...")
    
    # 主管 A 的報表 (研發部門)
    data_a = {
        '工號': ['A001', 'A002', 'A003', 'A004', 'A005'],
        '姓名': ['王小明', '李美玲', '張大偉', '陳怡君', '林志豪'],
        '部門': ['研發一部', '研發一部', '研發二部', '研發二部', '研發一部'],
        '本月績效分數': [92, 88, 85, 90, 87],
        '出勤狀況': ['正常', '正常', '請假1天', '正常', '遲到1次'],
        '主管評語': ['表現優異', '持續進步', '需加強時間管理', '穩定表現', '略有鬆懈']
    }
    
    # 主管 B 的報表 (品保/製造)
    data_b = {
        '工號': ['A006', 'A007', 'A008', 'A009', 'A010'],
        '姓名': ['黃淑芬', '劉建宏', '吳雅琪', '蔡明哲', '許雅婷'],
        '部門': ['品保部', '品保部', '製造部', '製造部', '製造部'],
        '本月績效分數': [91, 83, 79, 86, 88],
        '出勤狀況': ['正常', '請假2天', '正常', '正常', '加班10小時'],
        '主管評語': ['細心負責', '需改善品質意識', '基本合格', '進步明顯', '積極主動']
    }
    
    # 主管 C 的報表 (行政單位)
    data_c = {
        '工號': ['A011', 'A012', 'A013', 'A014', 'A015'],
        '姓名': ['楊宗翰', '鄭佳蓉', '周俊傑', '謝宜靜', '趙文彬'],
        '部門': ['人資部', '財務部', '財務部', '業務部', '業務部'],
        '本月績效分數': [89, 94, 87, 96, 82],
        '出勤狀況': ['正常', '正常', '請假1天', '正常', '遲到2次'],
        '主管評語': ['熱心助人', '數字精準', '需加強效率', '業績達標', '態度需調整']
    }
    
    pd.DataFrame(data_a).to_excel(f'{OUTPUT_DIR}/test_m3_manager_A_report.xlsx', index=False)
    pd.DataFrame(data_b).to_excel(f'{OUTPUT_DIR}/test_m3_manager_B_report.xlsx', index=False)
    pd.DataFrame(data_c).to_excel(f'{OUTPUT_DIR}/test_m3_manager_C_report.xlsx', index=False)
    
    print(f"  ✓ 建立 3 份主管報表: test_m3_manager_A/B/C_report.xlsx")


# ============================================================
# 模組 4: 員工查詢 Dashboard - 測試資料
# 員工主檔 + 績效 + 訓練紀錄
# ============================================================

def create_m4_test_data():
    print("建立模組 4 測試資料: 員工查詢 Dashboard...")
    
    # 員工主檔
    employee_master = {
        '工號': ['A001', 'A002', 'A003', 'A004', 'A005', 'A006', 'A007', 'A008', 'A009', 'A010', 'A011', 'A012'],
        '姓名': ['王小明', '李美玲', '張大偉', '陳怡君', '林志豪', '黃淑芬', '劉建宏', '吳雅琪', '蔡明哲', '許雅婷', '楊宗翰', '鄭佳蓉'],
        '身分證字號': ['A123456789', 'B234567890', 'C345678901', 'D456789012', 'E567890123', 
                    'F678901234', 'G789012345', 'H890123456', 'I901234567', 'J012345678', 'K123456780', 'L234567891'],
        '部門': ['研發一部', '研發二部', '品保部', '製造部', '人資部', '財務部', '業務部', '採購部', '研發一部', '研發二部', '人資部', '財務部'],
        '職稱': ['工程師', '資深工程師', '品保工程師', '技術員', '人資專員', '財務專員', '業務代表', '採購專員', '助理工程師', '工程師', '人資主管', '財務主管'],
        '到職日': ['2020-03-15', '2018-06-20', '2019-09-10', '2021-01-05', '2022-04-18', 
                 '2017-08-22', '2020-11-30', '2023-02-14', '2024-05-01', '2023-08-15', '2015-03-01', '2016-07-20'],
        '狀態': ['在職', '在職', '在職', '在職', '在職', '在職', '在職', '在職', '在職', '在職', '在職', '在職'],
        '直屬主管': ['陳經理', '陳經理', '林經理', '林經理', '楊宗翰', '鄭佳蓉', '趙經理', '趙經理', '陳經理', '陳經理', '王總監', '王總監']
    }
    
    # 績效紀錄 (多年)
    performance_records = {
        '工號': ['A001', 'A001', 'A001', 'A002', 'A002', 'A002', 'A003', 'A003', 'A004', 'A004', 
                'A005', 'A006', 'A006', 'A006', 'A007', 'A008', 'A009', 'A010', 'A011', 'A012'],
        '年度': [2022, 2023, 2024, 2022, 2023, 2024, 2023, 2024, 2023, 2024,
                2024, 2022, 2023, 2024, 2024, 2024, 2024, 2024, 2024, 2024],
        '考績等第': ['A', 'A', 'A', 'B+', 'A', 'A', 'B', 'B+', 'B', 'B+',
                   'B', 'A', 'A', 'B+', 'B', 'B+', 'B', 'B+', 'A', 'A'],
        '績效分數': [95, 93, 92, 88, 91, 90, 82, 86, 80, 85, 
                   83, 94, 92, 87, 81, 85, 82, 86, 91, 93],
        '調薪幅度': ['5%', '4%', '4%', '3%', '4%', '4%', '2%', '3%', '2%', '3%',
                   '2%', '5%', '4%', '3%', '2%', '3%', '2%', '3%', '4%', '4%']
    }
    
    # 訓練紀錄
    training_records = {
        '工號': ['A001', 'A001', 'A001', 'A002', 'A002', 'A003', 'A003', 'A004', 'A005', 'A006',
                'A007', 'A008', 'A009', 'A009', 'A010', 'A011', 'A011', 'A012', 'A012', 'A012'],
        '課程名稱': ['新人訓', '資安訓練', 'Python 入門', '新人訓', '專案管理', '新人訓', 'ISO 14001', '新人訓', '新人訓', '資安訓練',
                   '溝通技巧', '新人訓', '新人訓', '職安衛生', '新人訓', '資安訓練', '領導力培訓', '資安訓練', '財務分析', 'Excel 進階'],
        '課程類型': ['必修', '必修', '選修', '必修', '選修', '必修', '必修', '必修', '必修', '必修',
                   '選修', '必修', '必修', '必修', '必修', '必修', '選修', '必修', '選修', '選修'],
        '時數': [8, 4, 16, 8, 12, 8, 8, 8, 8, 4, 8, 8, 8, 4, 8, 4, 16, 4, 12, 8],
        '完訓日期': ['2020-03-20', '2020-04-15', '2020-06-30', '2018-07-10', '2019-03-20', '2019-09-25', '2020-01-15', '2021-01-20', '2022-04-25', '2017-09-10',
                   '2021-05-20', '2023-02-28', '2024-05-15', '2024-06-20', '2023-08-30', '2015-04-10', '2018-09-15', '2016-08-10', '2017-03-20', '2018-06-15'],
        '成績': ['Pass', 'Pass', '92分', 'Pass', '88分', 'Pass', 'Pass', 'Pass', 'Pass', 'Pass',
                '85分', 'Pass', 'Pass', 'Pass', 'Pass', 'Pass', '90分', 'Pass', '95分', '88分']
    }
    
    pd.DataFrame(employee_master).to_excel(f'{OUTPUT_DIR}/test_m4_employee_master.xlsx', index=False)
    pd.DataFrame(performance_records).to_excel(f'{OUTPUT_DIR}/test_m4_performance.xlsx', index=False)
    pd.DataFrame(training_records).to_excel(f'{OUTPUT_DIR}/test_m4_training.xlsx', index=False)
    
    print(f"  ✓ 建立員工主檔 (12筆)、績效紀錄 (20筆)、訓練紀錄 (20筆)")


# ============================================================
# 模組 5: 資格檢核器 - 測試資料
# 離職回任申請者資料 + 黑名單 + 歷史考績
# ============================================================

def create_m5_test_data():
    print("建立模組 5 測試資料: 資格檢核器...")
    
    # 離職回任申請者
    applicants = {
        '申請編號': ['REH001', 'REH002', 'REH003', 'REH004', 'REH005', 'REH006', 'REH007', 'REH008', 'REH009', 'REH010', 'REH011', 'REH012'],
        '姓名': ['林曉華', '陳建志', '王志偉', '蘇美惠', '葉俊宏', '潘雅芳', '魏大同', '江秀英', '曾志明', '黃麗君', '洪正義', '謝淑珍'],
        '身分證字號': ['M123456789', 'N234567890', 'O345678901', 'P456789012', 'Q567890123', 
                    'R678901234', 'S789012345', 'T890123456', 'U901234567', 'V012345678', 'W123456780', 'X234567891'],
        '申請日期': ['2025-01-02'] * 12,
        '原部門': ['研發一部', '品保部', '製造部', '人資部', '財務部', '業務部', '採購部', '研發二部', '品保部', '製造部', '研發一部', '財務部'],
        '原職稱': ['資深工程師', '品保主管', '技術員', '人資專員', '會計', '業務代表', '採購專員', '工程師', '品保工程師', '作業員', '經理', '財務專員'],
        '離職日期': ['2024-06-30', '2024-03-15', '2023-12-31', '2024-08-20', '2024-01-31', 
                   '2024-05-15', '2024-09-30', '2024-07-31', '2024-04-30', '2024-02-28', '2023-06-30', '2024-10-15'],
        '離職原因': ['個人因素', '轉職', '家庭因素', '健康因素', '進修', '創業', '搬遷', '轉職', '公司資遣', '合約到期', '主管不和', '薪資不滿'],
        '申請職缺': ['資深工程師', '品保主管', '資深技術員', '人資專員', '會計', '業務主管', '採購專員', '資深工程師', '品保工程師', '技術員', '副理', '財務主管'],
        '備註': ['前主管推薦', '', '表現良好', '', '已完成學業', '', '已搬回', '', '非績效因素', '', '需了解離職原因', '薪資已調整']
    }
    
    # 黑名單
    blacklist = {
        '身分證字號': ['Z999888777', 'Y888777666', 'W123456780'],  # W123456780 = 洪正義在黑名單
        '姓名': ['張某某', '李某某', '洪正義'],
        '列入日期': ['2020-05-15', '2021-08-20', '2023-08-01'],
        '原因': ['偷竊公司財物', '洩漏商業機密', '嚴重違反紀律'],
        '永久/期限': ['永久', '永久', '5年']
    }
    
    # HCP 他公司在職查詢結果
    hcp_status = {
        '身分證字號': ['M123456789', 'N234567890', 'O345678901', 'P456789012', 'Q567890123', 
                    'R678901234', 'S789012345', 'T890123456', 'U901234567', 'V012345678', 'W123456780', 'X234567891'],
        '姓名': ['林曉華', '陳建志', '王志偉', '蘇美惠', '葉俊宏', '潘雅芳', '魏大同', '江秀英', '曾志明', '黃麗君', '洪正義', '謝淑珍'],
        'ASUS': ['無', '無', '無', '無', '無', '無', '無', '無', '無', '無', '無', '無'],
        '和碩': ['無', '在職', '無', '無', '無', '無', '無', '無', '無', '無', '無', '無'],  # 陳建志在和碩在職
        '華碩電腦': ['無', '無', '無', '無', '無', '無', '無', '無', '無', '無', '無', '無'],
        '亞旭': ['無', '無', '無', '無', '無', '無', '無', '無', '無', '無', '無', '無']
    }
    
    # 歷史績效 (離職前)
    historical_performance = {
        '身分證字號': ['M123456789', 'M123456789', 'N234567890', 'N234567890', 'O345678901', 
                    'P456789012', 'Q567890123', 'R678901234', 'S789012345', 'T890123456',
                    'U901234567', 'V012345678', 'W123456780', 'W123456780', 'X234567891'],
        '姓名': ['林曉華', '林曉華', '陳建志', '陳建志', '王志偉', '蘇美惠', '葉俊宏', '潘雅芳', '魏大同', '江秀英', '曾志明', '黃麗君', '洪正義', '洪正義', '謝淑珍'],
        '年度': [2023, 2024, 2023, 2024, 2023, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2022, 2023, 2024],
        '考績等第': ['A', 'A', 'A', 'B+', 'B', 'B+', 'B', 'B', 'B+', 'A', 'C', 'B', 'C', 'D', 'B+'],  # 曾志明C、洪正義C/D
        '績效分數': [93, 91, 92, 87, 82, 86, 83, 81, 85, 90, 72, 80, 70, 65, 86]
    }
    
    pd.DataFrame(applicants).to_excel(f'{OUTPUT_DIR}/test_m5_applicants.xlsx', index=False)
    pd.DataFrame(blacklist).to_excel(f'{OUTPUT_DIR}/test_m5_blacklist.xlsx', index=False)
    pd.DataFrame(hcp_status).to_excel(f'{OUTPUT_DIR}/test_m5_hcp_status.xlsx', index=False)
    pd.DataFrame(historical_performance).to_excel(f'{OUTPUT_DIR}/test_m5_historical_performance.xlsx', index=False)
    
    print(f"  ✓ 建立申請者清單 (12筆)、黑名單 (3筆)、HCP狀態 (12筆)、歷史績效 (15筆)")


# ============================================================
# 模組 6: 到期提醒系統 - 測試資料
# 新進人員名單 (含到職日，用於計算試用期)
# ============================================================

def create_m6_test_data():
    print("建立模組 6 測試資料: 到期提醒系統...")
    
    # 新進人員名單
    base_date = datetime(2024, 10, 1)
    new_hires = {
        '工號': ['N001', 'N002', 'N003', 'N004', 'N005', 'N006', 'N007', 'N008', 'N009', 'N010', 'N011', 'N012'],
        '姓名': ['新人小王', '新人小李', '新人小張', '新人小陳', '新人小林', '新人小黃', '新人小劉', '新人小吳', '新人小蔡', '新人小許', '新人小楊', '新人小鄭'],
        '部門': random.choices(DEPARTMENTS, k=12),
        '職稱': ['工程師', '專員', '助理工程師', '技術員', '工程師', '專員', '業務代表', '採購專員', '工程師', '專員', '助理', '主管'],
        '到職日': [
            '2024-10-01',  # 試用期滿: 2025-01-01 (已過)
            '2024-10-05',  # 試用期滿: 2025-01-05 (即將到期)
            '2024-10-15',  # 試用期滿: 2025-01-15
            '2024-10-20',  # 試用期滿: 2025-01-20
            '2024-11-01',  # 試用期滿: 2025-02-01
            '2024-11-10',  # 試用期滿: 2025-02-10
            '2024-11-15',  # 試用期滿: 2025-02-15
            '2024-12-01',  # 試用期滿: 2025-03-01
            '2024-12-10',  # 試用期滿: 2025-03-10
            '2024-12-20',  # 試用期滿: 2025-03-20
            '2025-01-02',  # 試用期滿: 2025-04-02 (剛報到)
            '2025-01-02',  # 試用期滿: 2025-04-02 (剛報到)
        ],
        '試用期月數': [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
        '直屬主管': ['陳經理', '陳經理', '林經理', '林經理', '楊主管', '鄭主管', '趙經理', '趙經理', '陳經理', '陳經理', '王總監', '王總監'],
        '聯絡分機': ['1001', '1002', '1003', '1004', '2001', '2002', '3001', '3002', '1005', '1006', '4001', '4002'],
        '備註': ['', '', '', '', '', '', '', '', '', '', '今日報到', '今日報到']
    }
    
    # 已追蹤清單 (展示狀態管理)
    tracking_list = {
        '追蹤編號': ['TRK001', 'TRK002', 'TRK003', 'TRK004', 'TRK005'],
        '工號': ['N001', 'N002', 'N003', 'N004', 'N005'],
        '姓名': ['新人小王', '新人小李', '新人小張', '新人小陳', '新人小林'],
        '提醒類型': ['試用期滿', '試用期滿', '試用期滿', '試用期滿', '試用期滿'],
        '到期日': ['2025-01-01', '2025-01-05', '2025-01-15', '2025-01-20', '2025-02-01'],
        '狀態': ['已完成', '待處理', '待處理', '待處理', '待處理'],
        '完成日期': ['2025-01-02', '', '', '', ''],
        '處理人': ['HR王專員', '', '', '', ''],
        '備註': ['已調薪', '本週到期', '', '', '']
    }
    
    pd.DataFrame(new_hires).to_excel(f'{OUTPUT_DIR}/test_m6_new_hires.xlsx', index=False)
    pd.DataFrame(tracking_list).to_excel(f'{OUTPUT_DIR}/test_m6_tracking_list.xlsx', index=False)
    
    print(f"  ✓ 建立新進人員名單 (12筆)、追蹤清單 (5筆)")


# ============================================================
# 主程式
# ============================================================

if __name__ == '__main__':
    print("=" * 60)
    print("HR 資料處理工具 - 測試資料生成器")
    print("=" * 60)
    print()
    
    create_m1_test_data()
    create_m2_test_data()
    create_m3_test_data()
    create_m4_test_data()
    create_m5_test_data()
    create_m6_test_data()
    
    print()
    print("=" * 60)
    print("所有測試資料已生成完畢!")
    print(f"輸出目錄: {OUTPUT_DIR}")
    print("=" * 60)
    
    # 列出所有檔案
    print("\n生成的檔案清單:")
    for f in sorted(os.listdir(OUTPUT_DIR)):
        filepath = os.path.join(OUTPUT_DIR, f)
        size = os.path.getsize(filepath)
        print(f"  • {f} ({size:,} bytes)")
